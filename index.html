<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gorilla Strong - HIT Workout Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        #root {
            min-height: 100vh;
        }

        .diamond-plate {
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,.05) 10px, rgba(255,255,255,.05) 20px),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(255,255,255,.05) 10px, rgba(255,255,255,.05) 20px);
        }

        .gorilla-bg {
            background-image: url('https://images.unsplash.com/photo-1551135049-8a33b5883817?w=1200&h=800&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .gorilla-overlay {
            background: rgba(0, 0, 0, 0.85);
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        chrome: {
                            50: '#f8f9fa',
                            100: '#e9ecef',
                            200: '#dee2e6',
                            300: '#ced4da',
                            400: '#adb5bd',
                            500: '#6c757d',
                            600: '#495057',
                            700: '#343a40',
                            800: '#212529',
                            900: '#0d0d0d',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="gorilla-bg">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function GorillaStrongApp() {
          const [currentExercise, setCurrentExercise] = useState(null);
          const [currentSet, setCurrentSet] = useState({ weight: 0, reps: 0, seconds: 0 });
          const [workoutHistory, setWorkoutHistory] = useState([]);
          const [activeWorkoutName, setActiveWorkoutName] = useState('');
          const [currentWorkout, setCurrentWorkout] = useState([]);
          const [showProgress, setShowProgress] = useState(false);
          const [selectedExercise, setSelectedExercise] = useState(null);
          const [showWorkoutBuilder, setShowWorkoutBuilder] = useState(false);
          const [customWorkouts, setCustomWorkouts] = useState([]);
          const [editingWorkout, setEditingWorkout] = useState(null);
          const [newWorkoutName, setNewWorkoutName] = useState('');
          const [selectedExercises, setSelectedExercises] = useState([]);
          const [restTimer, setRestTimer] = useState(false);
          const [restTimeRemaining, setRestTimeRemaining] = useState(0);
          const [wakeLock, setWakeLock] = useState(null);
          const [currentExerciseEquipmentMode, setCurrentExerciseEquipmentMode] = useState('machine');
          const [isChirping, setIsChirping] = useState(false);
          const [chirpVolume, setChirpVolume] = useState(50); // 0-100 volume
          const [restPeriod, setRestPeriod] = useState(180); // Rest period in seconds (default 3 minutes)
          
          const chirpIntervalRef = useRef(null);
          const audioContextRef = useRef(null);

          const MACHINE_TO_FREEWEIGHT_RATIO = 0.75;
          const CHIRP_INTERVAL = 4000; // 4 seconds

          const defaultWorkouts = {
            'Full Body': ['Leg Press', 'Chest Press', 'Pulldown', 'Shoulder Press', 'Leg Curl', 'Bicep Curl', 'Tricep Extension'],
            'Upper Body': ['Chest Press', 'Pulldown', 'Shoulder Press', 'Row', 'Bicep Curl', 'Tricep Extension', 'Lateral Raise'],
            'Lower Body': ['Leg Press', 'Leg Curl', 'Leg Extension', 'Calf Raise', 'Hip Abduction', 'Hip Adduction'],
            'Push Day': ['Chest Press', 'Shoulder Press', 'Incline Press', 'Tricep Extension', 'Lateral Raise', 'Overhead Press'],
            'Pull Day': ['Pulldown', 'Row', 'Face Pull', 'Bicep Curl', 'Shrug', 'Rear Delt Fly']
          };

          const allExercises = [
            'Chest Press', 'Incline Press', 'Decline Press', 'Fly', 'Dip',
            'Pulldown', 'Row', 'Deadlift', 'Shrug', 'Face Pull', 'Rear Delt Fly',
            'Shoulder Press', 'Overhead Press', 'Lateral Raise', 'Front Raise',
            'Bicep Curl', 'Hammer Curl', 'Preacher Curl', 'Tricep Extension', 'Tricep Pushdown', 'Skull Crusher',
            'Leg Press', 'Squat', 'Leg Extension', 'Leg Curl', 'Calf Raise', 'Hip Abduction', 'Hip Adduction', 'Lunge',
            'Ab Crunch', 'Plank', 'Russian Twist', 'Leg Raise'
          ].sort();

          // Audio chirp function
          const playChirp = () => {
            if (chirpVolume === 0) return; // Silent if volume is 0
            
            try {
              if (!audioContextRef.current) {
                audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
              }
              
              const ctx = audioContextRef.current;
              const oscillator = ctx.createOscillator();
              const gainNode = ctx.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(ctx.destination);
              
              oscillator.frequency.value = 440;
              oscillator.type = 'sine';
              
              // Volume from 0-100 converted to 0.0-1.0 for gain (louder!)
              const volume = (chirpVolume / 100) * 1.0;
              gainNode.gain.setValueAtTime(volume, ctx.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
              
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + 0.15);
              
              console.log('Chirp played at volume:', chirpVolume);
            } catch (e) {
              console.error('Chirp error:', e);
            }
          };

          // Chirping effect
          useEffect(() => {
            if (isChirping) {
              console.log('Starting chirps');
              playChirp();
              chirpIntervalRef.current = setInterval(() => {
                console.log('Interval chirp');
                playChirp();
              }, CHIRP_INTERVAL);
            } else {
              console.log('Stopping chirps');
              if (chirpIntervalRef.current) {
                clearInterval(chirpIntervalRef.current);
                chirpIntervalRef.current = null;
              }
            }
            
            return () => {
              if (chirpIntervalRef.current) {
                clearInterval(chirpIntervalRef.current);
              }
            };
          }, [isChirping]);

          // Wake Lock functionality - FIXED
          useEffect(() => {
            let lock = null;
            
            const requestWakeLock = async () => {
              try {
                if ('wakeLock' in navigator && (activeWorkoutName || currentExercise)) {
                  lock = await navigator.wakeLock.request('screen');
                  setWakeLock(lock);
                  console.log('Wake Lock activated');
                  
                  lock.addEventListener('release', () => {
                    console.log('Wake Lock released');
                  });
                }
              } catch (err) {
                console.error('Wake Lock error:', err);
              }
            };

            requestWakeLock();

            return () => {
              if (lock) {
                lock.release().catch(() => {});
              }
            };
          }, [activeWorkoutName, currentExercise]);

          // Rest timer functionality - FIXED
          useEffect(() => {
            let interval;
            if (restTimer && restTimeRemaining > 0) {
              interval = setInterval(() => {
                setRestTimeRemaining(prev => {
                  if (prev <= 1) {
                    setRestTimer(false);
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
            }
            return () => {
              if (interval) clearInterval(interval);
            };
          }, [restTimer, restTimeRemaining]);

          // Scroll to top when rest timer starts
          useEffect(() => {
            if (restTimer) {
              setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
              }, 100);
            }
          }, [restTimer]);

          // Scroll to top when screens change
          useEffect(() => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }, [currentExercise, activeWorkoutName, showProgress, showWorkoutBuilder]);

          useEffect(() => {
            const saved = localStorage.getItem('hitWorkoutHistory');
            if (saved) {
              try {
                setWorkoutHistory(JSON.parse(saved));
              } catch (e) {
                console.error('Error loading history:', e);
              }
            }

            const savedCustom = localStorage.getItem('customWorkouts');
            if (savedCustom) {
              try {
                setCustomWorkouts(JSON.parse(savedCustom));
              } catch (e) {
                console.error('Error loading custom workouts:', e);
              }
            }
            
            const savedVolume = localStorage.getItem('chirpVolume');
            if (savedVolume) {
              try {
                setChirpVolume(parseInt(savedVolume));
              } catch (e) {
                console.error('Error loading volume:', e);
              }
            }
            
            const savedRestPeriod = localStorage.getItem('restPeriod');
            if (savedRestPeriod) {
              try {
                setRestPeriod(parseInt(savedRestPeriod));
              } catch (e) {
                console.error('Error loading rest period:', e);
              }
            }
          }, []);

          useEffect(() => {
            localStorage.setItem('hitWorkoutHistory', JSON.stringify(workoutHistory));
          }, [workoutHistory]);

          useEffect(() => {
            localStorage.setItem('customWorkouts', JSON.stringify(customWorkouts));
          }, [customWorkouts]);

          useEffect(() => {
            localStorage.setItem('chirpVolume', chirpVolume.toString());
          }, [chirpVolume]);

          useEffect(() => {
            localStorage.setItem('restPeriod', restPeriod.toString());
          }, [restPeriod]);

          const convertWeight = (weight, fromType, toType) => {
            if (fromType === toType) return weight;
            if (fromType === 'machine' && toType === 'freeweight') {
              return Math.round(weight * MACHINE_TO_FREEWEIGHT_RATIO / 5) * 5;
            }
            if (fromType === 'freeweight' && toType === 'machine') {
              return Math.round((weight / MACHINE_TO_FREEWEIGHT_RATIO) / 5) * 5;
            }
            return weight;
          };

          const getPreviousStats = (exerciseName, equipmentType) => {
            const exerciseHistory = workoutHistory
              .filter(w => w.exercises.some(e => e.exercise === exerciseName))
              .flatMap(w => w.exercises.filter(e => e.exercise === exerciseName)
                .map(e => ({
                  ...e,
                  date: new Date(w.timestamp).toLocaleDateString(),
                  workoutName: w.workoutName,
                  equipmentType: e.equipmentType || 'machine'
                })));

            if (exerciseHistory.length === 0) return null;

            const latestSameEquipment = exerciseHistory
              .filter(e => e.equipmentType === equipmentType)
              .sort((a, b) => new Date(b.date) - new Date(a.date))[0];

            if (latestSameEquipment) {
              return { ...latestSameEquipment, isEstimate: false };
            }

            const latestOtherEquipment = exerciseHistory
              .sort((a, b) => new Date(b.date) - new Date(a.date))[0];

            if (latestOtherEquipment) {
              const convertedWeight = convertWeight(
                latestOtherEquipment.weight,
                latestOtherEquipment.equipmentType,
                equipmentType
              );
              return {
                ...latestOtherEquipment,
                weight: convertedWeight,
                isEstimate: true
              };
            }

            return null;
          };

          const startWorkout = (workoutType) => {
            const exercises = customWorkouts.find(w => w.name === workoutType)?.exercises || 
                             defaultWorkouts[workoutType] || [];
            setActiveWorkoutName(workoutType);
            setCurrentWorkout(exercises.map(name => ({ name, completed: false, skipped: false })));
          };

          const startExercise = (exercise) => {
            setCurrentExercise(exercise);
            setCurrentExerciseEquipmentMode('machine');
            if (chirpVolume > 0) {
              setIsChirping(true); // START CHIRPING (only if volume > 0)
            }
            const prevStats = getPreviousStats(exercise.name, 'machine');
            if (prevStats) {
              setCurrentSet({
                weight: prevStats.weight,
                reps: prevStats.reps,
                seconds: prevStats.seconds || 0
              });
            } else {
              setCurrentSet({ weight: 0, reps: 0, seconds: 0 });
            }
          };

          const completeSet = () => {
            setIsChirping(false); // STOP CHIRPING
            
            console.log('Complete Set clicked!');
            console.log('Current set:', currentSet);
            
            if (!currentExercise) {
              console.log('No current exercise');
              return;
            }
            
            if (currentSet.weight === 0 && currentSet.reps === 0 && currentSet.seconds === 0) {
              console.log('No data entered');
              return;
            }

            const completed = {
              exercise: currentExercise.name,
              weight: currentSet.weight,
              reps: currentSet.reps,
              seconds: currentSet.seconds,
              equipmentType: currentExerciseEquipmentMode,
              timestamp: new Date().toISOString()
            };

            console.log('Completing exercise:', completed);

            setCurrentWorkout(prev => {
              const updated = prev.map(ex => 
                ex.name === currentExercise.name ? { ...ex, completed: true, data: completed } : ex
              );
              
              // Auto-save progress immediately after each exercise
              const tempWorkout = {
                workoutName: activeWorkoutName,
                timestamp: new Date().toISOString(),
                exercises: updated.filter(ex => ex.completed).map(ex => ex.data),
                skipped: updated.filter(ex => ex.skipped).map(ex => ex.name),
                inProgress: true
              };
              
              // Save to temp storage
              localStorage.setItem('hitWorkoutInProgress', JSON.stringify(tempWorkout));
              console.log('Auto-saved workout progress');
              
              return updated;
            });

            // Start rest timer
            console.log('Starting rest timer');
            setRestTimer(true);
            setRestTimeRemaining(restPeriod);

            setCurrentExercise(null);
          };

          const skipExercise = () => {
            setIsChirping(false); // STOP CHIRPING
            
            if (!currentExercise) return;
            
            setCurrentWorkout(prev => prev.map(ex =>
              ex.name === currentExercise.name ? { ...ex, skipped: true } : ex
            ));
            
            const nextIncomplete = currentWorkout.find(ex => 
              !ex.completed && 
              !ex.skipped &&
              ex.name !== currentExercise.name
            );

            if (nextIncomplete) {
              startExercise(nextIncomplete);
            } else {
              setCurrentExercise(null);
            }
          };

          const unskipExercise = (exerciseName) => {
            setCurrentWorkout(prev => prev.map(ex =>
              ex.name === exerciseName ? { ...ex, skipped: false } : ex
            ));
          };

          const finishWorkout = () => {
            setIsChirping(false); // STOP CHIRPING
            
            const completedExercises = currentWorkout.filter(ex => ex.completed).map(ex => ex.data);
            
            if (completedExercises.length > 0) {
              const workout = {
                workoutName: activeWorkoutName,
                timestamp: new Date().toISOString(),
                exercises: completedExercises,
                skipped: currentWorkout.filter(ex => ex.skipped).map(ex => ex.name)
              };

              setWorkoutHistory(prev => [workout, ...prev]);
            }
            
            // Clear temp storage since workout is complete
            localStorage.removeItem('hitWorkoutInProgress');

            setActiveWorkoutName('');
            setCurrentWorkout([]);
            setCurrentExercise(null);
            setCurrentSet({ weight: 0, reps: 0, seconds: 0 });
            setRestTimer(false);
            setRestTimeRemaining(0);
          };

          const saveCustomWorkout = () => {
            if (!newWorkoutName.trim() || selectedExercises.length === 0) return;

            const workout = {
              name: newWorkoutName.trim(),
              exercises: selectedExercises,
              id: editingWorkout?.id || Date.now()
            };

            if (editingWorkout) {
              setCustomWorkouts(prev => prev.map(w => w.id === editingWorkout.id ? workout : w));
            } else {
              setCustomWorkouts(prev => [...prev, workout]);
            }

            setNewWorkoutName('');
            setSelectedExercises([]);
            setEditingWorkout(null);
            setShowWorkoutBuilder(false);
          };

          const deleteCustomWorkout = (id) => {
            if (confirm('Delete this workout?')) {
              setCustomWorkouts(prev => prev.filter(w => w.id !== id));
            }
          };

          const editCustomWorkout = (workout) => {
            setEditingWorkout(workout);
            setNewWorkoutName(workout.name);
            setSelectedExercises(workout.exercises);
            setShowWorkoutBuilder(true);
          };

          const toggleExerciseSelection = (exercise) => {
            setSelectedExercises(prev => 
              prev.includes(exercise) 
                ? prev.filter(e => e !== exercise)
                : [...prev, exercise]
            );
          };

          const getExerciseStats = (exerciseName) => {
            const history = workoutHistory
              .flatMap(w => w.exercises.filter(e => e.exercise === exerciseName))
              .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            if (history.length === 0) return null;

            const latest = history[0];
            const maxWeight = Math.max(...history.map(e => e.weight));
            const maxReps = Math.max(...history.filter(e => e.weight === maxWeight).map(e => e.reps));

            return {
              latest,
              maxWeight,
              maxReps,
              totalSessions: history.length
            };
          };

          const completedCount = currentWorkout.filter(ex => ex.completed).length;
          const totalCount = currentWorkout.length;
          const progress = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;

          const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          if (showWorkoutBuilder) {
            return (
              <div className="min-h-screen gorilla-overlay p-4 text-chrome-100">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-chrome-800 rounded-xl p-6 shadow-2xl border border-chrome-600 diamond-plate">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-2xl font-bold flex items-center gap-2 text-chrome-100">
                        ‚úèÔ∏è {editingWorkout ? 'Edit Workout' : 'Create Custom Workout'}
                      </h2>
                      <button onClick={() => {
                        setShowWorkoutBuilder(false);
                        setNewWorkoutName('');
                        setSelectedExercises([]);
                        setEditingWorkout(null);
                      }} className="p-2 hover:bg-chrome-700 rounded-lg transition-colors text-2xl">
                        ‚úï
                      </button>
                    </div>

                    <div className="mb-6">
                      <label className="block text-sm font-semibold mb-2">Workout Name:</label>
                      <input
                        type="text"
                        value={newWorkoutName}
                        onChange={(e) => setNewWorkoutName(e.target.value)}
                        placeholder="e.g., Monday Upper Body"
                        className="w-full bg-chrome-900 rounded-lg px-4 py-3 focus:ring-2 focus:ring-chrome-500 outline-none text-chrome-100 border border-chrome-700"
                      />
                    </div>

                    <div className="mb-4">
                      <div className="flex items-center justify-between mb-2">
                        <label className="text-sm font-semibold">
                          Select Exercises ({selectedExercises.length})
                        </label>
                        {selectedExercises.length > 0 && (
                          <button
                            onClick={() => setSelectedExercises([])}
                            className="text-xs text-red-400 hover:text-red-300"
                          >
                            Clear All
                          </button>
                        )}
                      </div>
                      <div className="grid grid-cols-2 gap-2 max-h-96 overflow-y-auto p-2 bg-black rounded-lg border border-chrome-700">
                        {allExercises.map(exercise => (
                          <button
                            key={exercise}
                            onClick={() => toggleExerciseSelection(exercise)}
                            className={`px-3 py-2 rounded-lg text-left text-sm transition-colors border ${
                              selectedExercises.includes(exercise)
                                ? 'bg-chrome-600 hover:bg-chrome-500 border-chrome-400'
                                : 'bg-chrome-800 hover:bg-chrome-700 border-chrome-700'
                            }`}
                          >
                            {exercise}
                          </button>
                        ))}
                      </div>
                    </div>

                    <button
                      onClick={saveCustomWorkout}
                      disabled={!newWorkoutName.trim() || selectedExercises.length === 0}
                      className="w-full bg-chrome-600 hover:bg-chrome-500 disabled:bg-chrome-800 disabled:cursor-not-allowed py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors border border-chrome-500"
                    >
                      üíæ {editingWorkout ? 'Update Workout' : 'Save Workout'}
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          if (showProgress) {
            return (
              <div className="min-h-screen gorilla-overlay p-4 text-chrome-100">
                <div className="max-w-6xl mx-auto">
                  <div className="bg-chrome-800 rounded-xl p-6 shadow-2xl border border-chrome-600 diamond-plate">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-2xl font-bold flex items-center gap-2">
                        üìà Progress Tracking
                      </h2>
                      <button onClick={() => setShowProgress(false)} className="p-2 hover:bg-chrome-700 rounded-lg transition-colors text-2xl">
                        ‚úï
                      </button>
                    </div>

                    {workoutHistory.length === 0 ? (
                      <div className="bg-black rounded-xl p-8 text-center border border-chrome-700">
                        <p className="text-chrome-400">Complete some workouts to see your progress!</p>
                      </div>
                    ) : (
                      <>
                        <div className="bg-black rounded-xl p-6 mb-6 border border-chrome-700">
                          <h3 className="font-semibold mb-3">Select Exercise:</h3>
                          <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                            {allExercises.map(exercise => {
                              const stats = getExerciseStats(exercise);
                              if (!stats) return null;
                              return (
                                <button
                                  key={exercise}
                                  onClick={() => setSelectedExercise(exercise)}
                                  className={`px-4 py-2 rounded-lg transition-colors text-left border ${
                                    selectedExercise === exercise
                                      ? 'bg-chrome-600 hover:bg-chrome-500 border-chrome-400'
                                      : 'bg-chrome-800 hover:bg-chrome-700 border-chrome-700'
                                  }`}
                                >
                                  {exercise}
                                </button>
                              );
                            })}
                          </div>
                        </div>

                        {selectedExercise && (() => {
                          const stats = getExerciseStats(selectedExercise);
                          if (!stats) return null;

                          const history = workoutHistory
                            .flatMap(w => w.exercises.filter(e => e.exercise === selectedExercise)
                              .map(e => ({
                                ...e,
                                date: new Date(w.timestamp).toLocaleDateString(),
                                workoutName: w.workoutName
                              })))
                            .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                            .slice(0, 10);

                          return (
                            <div className="bg-black rounded-xl p-6 border border-chrome-700">
                              <h3 className="text-xl font-bold mb-4">{selectedExercise}</h3>
                              <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="bg-chrome-800 rounded-lg p-4 border border-chrome-700 diamond-plate">
                                  <div className="text-sm text-chrome-400 mb-1">Personal Best</div>
                                  <div className="text-2xl font-bold text-chrome-300">
                                    {stats.maxWeight} lbs
                                  </div>
                                  <div className="text-sm text-chrome-400">{stats.maxReps} reps</div>
                                </div>
                                <div className="bg-chrome-800 rounded-lg p-4 border border-chrome-700 diamond-plate">
                                  <div className="text-sm text-chrome-400 mb-1">Latest</div>
                                  <div className="text-2xl font-bold">
                                    {stats.latest.weight} lbs
                                  </div>
                                  <div className="text-sm text-chrome-400">{stats.latest.reps} reps</div>
                                </div>
                                <div className="bg-chrome-800 rounded-lg p-4 border border-chrome-700 diamond-plate">
                                  <div className="text-sm text-chrome-400 mb-1">Total Sessions</div>
                                  <div className="text-2xl font-bold text-chrome-300">
                                    {stats.totalSessions}
                                  </div>
                                </div>
                              </div>

                              <h4 className="font-semibold mb-3">Recent History:</h4>
                              <div className="space-y-2">
                                {history.map((entry, idx) => (
                                  <div key={idx} className="bg-chrome-800 rounded-lg p-3 flex items-center justify-between border border-chrome-700 diamond-plate">
                                    <div>
                                      <div className="font-semibold">{entry.weight} lbs √ó {entry.reps} reps</div>
                                      <div className="text-xs text-chrome-400">
                                        {entry.workoutName} ‚Ä¢ {entry.date} ‚Ä¢ {entry.equipmentType}
                                      </div>
                                    </div>
                                    {entry.weight === stats.maxWeight && entry.reps === stats.maxReps && (
                                      <span className="text-yellow-400 text-xl">üèÜ</span>
                                    )}
                                  </div>
                                ))}
                              </div>
                            </div>
                          );
                        })()}
                      </>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          if (currentExercise) {
            const prevStats = getPreviousStats(currentExercise.name, currentExerciseEquipmentMode);
            
            return (
              <div className="min-h-screen gorilla-overlay p-4 text-chrome-100">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-chrome-800 rounded-xl p-6 shadow-2xl border border-chrome-600 diamond-plate">
                    <div className="mb-6">
                      <div className="flex items-center justify-between mb-2">
                        <h2 className="text-sm font-semibold text-chrome-300">{activeWorkoutName}</h2>
                        <span className="text-sm text-chrome-300">{completedCount} / {totalCount}</span>
                      </div>
                      <div className="w-full bg-chrome-900 rounded-full h-2 border border-chrome-700">
                        <div
                          className="bg-gradient-to-r from-chrome-500 to-chrome-400 h-2 rounded-full transition-all duration-300"
                          style={{ width: `${progress}%` }}
                        />
                      </div>
                    </div>

                    <div className="mb-6">
                      <div className="flex items-center gap-2 mb-2">
                        <h3 className="text-3xl font-bold" style={{ color: '#39FF14' }}>{currentExercise.name}</h3>
                      </div>
                      <p className="text-chrome-400 text-sm mb-3">One set to absolute failure</p>
                      
                      {/* Per-exercise equipment selector */}
                      <div className="flex items-center gap-2 mb-4">
                        <span className="text-sm text-chrome-400">Equipment:</span>
                        <button
                          onClick={() => {
                            setCurrentExerciseEquipmentMode('machine');
                            const stats = getPreviousStats(currentExercise.name, 'machine');
                            if (stats) {
                              setCurrentSet({
                                weight: stats.weight,
                                reps: stats.reps,
                                seconds: stats.seconds || 0
                              });
                            }
                          }}
                          className={`px-4 py-2 rounded-lg font-semibold transition-colors border ${
                            currentExerciseEquipmentMode === 'machine'
                              ? 'bg-chrome-600 hover:bg-chrome-500 border-chrome-400'
                              : 'bg-chrome-900 hover:bg-chrome-800 border-chrome-700'
                          }`}
                        >
                          Machine
                        </button>
                        <button
                          onClick={() => {
                            setCurrentExerciseEquipmentMode('freeweight');
                            const stats = getPreviousStats(currentExercise.name, 'freeweight');
                            if (stats) {
                              setCurrentSet({
                                weight: stats.weight,
                                reps: stats.reps,
                                seconds: stats.seconds || 0
                              });
                            }
                          }}
                          className={`px-4 py-2 rounded-lg font-semibold transition-colors border ${
                            currentExerciseEquipmentMode === 'freeweight'
                              ? 'bg-chrome-600 hover:bg-chrome-500 border-chrome-400'
                              : 'bg-chrome-900 hover:bg-chrome-800 border-chrome-700'
                          }`}
                        >
                          Free Weight
                        </button>
                      </div>
                    </div>

                    {/* COMPLETELY STACKED VERTICALLY - FULL WIDTH */}
                    <div className="space-y-4 mb-6">
                      <div className="bg-chrome-900 rounded-lg p-4 border border-chrome-700 diamond-plate w-full">
                        <label className="block text-lg font-semibold mb-3 text-center">Weight (lbs)</label>
                        <div className="flex items-center justify-center gap-3">
                          <button
                            onClick={() => {
                              const decrement = currentExerciseEquipmentMode === 'freeweight' && currentSet.weight <= 15 ? 1 : 5;
                              setCurrentSet(p => ({ ...p, weight: Math.max(0, p.weight - decrement) }));
                            }}
                            className="bg-chrome-700 hover:bg-chrome-600 p-4 rounded-lg text-2xl font-bold w-20 h-20 border border-chrome-600"
                          >
                            ‚àí{currentExerciseEquipmentMode === 'freeweight' && currentSet.weight <= 15 ? '1' : '5'}
                          </button>
                          <input
                            type="number"
                            value={currentSet.weight}
                            onChange={(e) => setCurrentSet(p => ({ ...p, weight: parseInt(e.target.value) || 0 }))}
                            className="bg-black text-center text-4xl font-mono font-bold py-4 rounded-lg w-32 focus:ring-2 focus:ring-chrome-500 outline-none text-chrome-100 border border-chrome-700"
                          />
                          <button
                            onClick={() => {
                              const increment = currentExerciseEquipmentMode === 'freeweight' && currentSet.weight < 15 ? 1 : 5;
                              setCurrentSet(p => ({ ...p, weight: p.weight + increment }));
                            }}
                            className="bg-chrome-600 hover:bg-chrome-500 p-4 rounded-lg text-2xl font-bold w-20 h-20 border border-chrome-500"
                          >
                            +{currentExerciseEquipmentMode === 'freeweight' && currentSet.weight < 15 ? '1' : '5'}
                          </button>
                        </div>
                        {prevStats && (
                          <button
                            onClick={() => setCurrentSet(p => ({ ...p, weight: prevStats.weight }))}
                            className="mt-3 w-full text-sm bg-chrome-800 hover:bg-chrome-700 py-2 rounded border border-chrome-700"
                          >
                            Use {prevStats.weight} lbs
                          </button>
                        )}
                      </div>

                      <div className="bg-chrome-900 rounded-lg p-4 border border-chrome-700 diamond-plate w-full">
                        <label className="block text-lg font-semibold mb-3 text-center">Reps</label>
                        <div className="flex items-center justify-center gap-3">
                          <button
                            onClick={() => setCurrentSet(p => ({ ...p, reps: Math.max(0, p.reps - 1) }))}
                            className="bg-chrome-700 hover:bg-chrome-600 p-4 rounded-lg text-2xl font-bold w-20 h-20 border border-chrome-600"
                          >
                            ‚àí1
                          </button>
                          <input
                            type="number"
                            value={currentSet.reps}
                            onChange={(e) => setCurrentSet(p => ({ ...p, reps: parseInt(e.target.value) || 0 }))}
                            className="bg-black text-center text-4xl font-mono font-bold py-4 rounded-lg w-32 focus:ring-2 focus:ring-chrome-500 outline-none text-chrome-100 border border-chrome-700"
                          />
                          <button
                            onClick={() => setCurrentSet(p => ({ ...p, reps: p.reps + 1 }))}
                            className="bg-chrome-600 hover:bg-chrome-500 p-4 rounded-lg text-2xl font-bold w-20 h-20 border border-chrome-500"
                          >
                            +1
                          </button>
                        </div>
                        {prevStats && (
                          <button
                            onClick={() => setCurrentSet(p => ({ ...p, reps: prevStats.reps }))}
                            className="mt-3 w-full text-sm bg-chrome-800 hover:bg-chrome-700 py-2 rounded border border-chrome-700"
                          >
                            Use {prevStats.reps} reps
                          </button>
                        )}
                      </div>
                    </div>

                    <div className="flex flex-col gap-3">
                      <button
                        onClick={() => {
                          console.log('Button clicked - about to call completeSet');
                          completeSet();
                        }}
                        disabled={currentSet.weight === 0 && currentSet.reps === 0}
                        className="w-full bg-chrome-600 hover:bg-chrome-500 disabled:bg-chrome-800 disabled:cursor-not-allowed py-5 rounded-lg font-bold text-xl transition-colors border-2 border-chrome-500"
                      >
                        Complete Set ‚úì
                      </button>
                      <button
                        onClick={skipExercise}
                        className="w-full bg-chrome-800 hover:bg-chrome-700 py-4 rounded-lg font-semibold transition-colors border border-chrome-700"
                      >
                        Skip Exercise
                      </button>
                    </div>

                    <div className="mt-4 pt-4 border-t border-chrome-700">
                      <h4 className="text-sm font-semibold mb-2 text-chrome-400">Remaining Exercises:</h4>
                      <div className="flex flex-wrap gap-2">
                        {currentWorkout.filter(ex => !ex.completed && ex.name !== currentExercise.name).map(ex => (
                          <span
                            key={ex.name}
                            className={`px-3 py-1 rounded-lg text-sm border ${
                              ex.skipped
                                ? 'bg-chrome-900 border-chrome-800'
                                : 'bg-chrome-800 border-chrome-700'
                            }`}
                            style={{ color: ex.skipped ? '#6c757d' : '#39FF14' }}
                          >
                            {ex.name}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (activeWorkoutName) {
            return (
              <div className="min-h-screen gorilla-overlay p-4 text-chrome-100">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-chrome-800 rounded-xl p-6 shadow-2xl border border-chrome-600 diamond-plate">
                    <div className="mb-6">
                      <div className="flex flex-col gap-3 mb-4">
                        <div className="flex items-center justify-between">
                          <h2 className="text-2xl font-bold">{activeWorkoutName}</h2>
                        </div>
                        
                        {/* Rest Period and Chirp Volume Controls */}
                        <div className="flex items-center gap-3 justify-between flex-wrap">
                          {/* Rest Period Control */}
                          <div className="flex items-center gap-3 bg-chrome-900 px-4 py-2 rounded-lg border-2 border-chrome-700">
                            <span className="text-sm font-semibold text-chrome-400">‚è±Ô∏è Rest</span>
                            <button
                              onClick={() => setRestPeriod(Math.max(30, restPeriod - 30))}
                              className="bg-chrome-700 hover:bg-chrome-600 px-2 py-1 rounded font-bold text-chrome-200"
                            >
                              -
                            </button>
                            <span className="text-sm font-mono text-chrome-300 w-16 text-center">
                              {Math.floor(restPeriod / 60)}:{(restPeriod % 60).toString().padStart(2, '0')}
                            </span>
                            <button
                              onClick={() => setRestPeriod(Math.min(600, restPeriod + 30))}
                              className="bg-chrome-700 hover:bg-chrome-600 px-2 py-1 rounded font-bold text-chrome-200"
                            >
                              +
                            </button>
                          </div>
                          
                          {/* Chirp Volume Control */}
                          <div className="flex items-center gap-3 bg-chrome-900 px-4 py-2 rounded-lg border-2 border-chrome-700">
                            <span className="text-sm font-semibold text-chrome-400">üîî Beep</span>
                            <input
                              type="range"
                              min="0"
                              max="100"
                              value={chirpVolume}
                              onChange={(e) => setChirpVolume(parseInt(e.target.value))}
                              className="w-24 h-2 bg-chrome-700 rounded-lg appearance-none cursor-pointer"
                              style={{
                                background: `linear-gradient(to right, #6c757d 0%, #6c757d ${chirpVolume}%, #343a40 ${chirpVolume}%, #343a40 100%)`
                              }}
                            />
                            <span className="text-sm font-mono text-chrome-300 w-8">{chirpVolume}%</span>
                          </div>
                        </div>
                      </div>
                      
                      {/* Rest Timer Display */}
                      {restTimer && restTimeRemaining > 0 && (
                        <div className="mb-4 p-6 bg-chrome-900 rounded-lg border-4 border-chrome-500 text-center diamond-plate">
                          <div className="text-lg text-chrome-400 mb-2 font-bold">REST PERIOD</div>
                          <div className="text-6xl font-mono font-bold text-chrome-200">
                            {formatTime(restTimeRemaining)}
                          </div>
                          <button
                            onClick={() => {
                              setRestTimer(false);
                              setRestTimeRemaining(0);
                            }}
                            className="mt-3 text-sm text-chrome-400 hover:text-chrome-300 underline"
                          >
                            Skip Rest
                          </button>
                        </div>
                      )}
                      
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm text-chrome-400">{completedCount} / {totalCount} completed</span>
                      </div>
                      <div className="w-full bg-chrome-900 rounded-full h-3 border border-chrome-700">
                        <div
                          className="bg-gradient-to-r from-chrome-500 to-chrome-400 h-3 rounded-full transition-all duration-300"
                          style={{ width: `${progress}%` }}
                        />
                      </div>
                    </div>

                    <div className="space-y-3">
                      {currentWorkout.map((exercise, idx) => (
                        <div
                          key={idx}
                          className={`p-4 rounded-lg transition-colors border diamond-plate ${
                            exercise.completed
                              ? 'bg-chrome-700 border-2 border-chrome-500'
                              : exercise.skipped
                              ? 'bg-chrome-900 opacity-50 border-chrome-800'
                              : 'bg-chrome-800 hover:bg-chrome-700 border-chrome-700'
                          }`}
                        >
                          <div className="flex items-center justify-between">
                            <div className="flex-1">
                              <h3 className="font-semibold text-lg" style={{ color: '#39FF14' }}>{exercise.name}</h3>
                              {exercise.completed && exercise.data && (
                                <p className="text-sm text-chrome-300 mt-1">
                                  {exercise.data.weight} lbs √ó {exercise.data.reps} reps ({exercise.data.equipmentType})
                                </p>
                              )}
                              {exercise.skipped && (
                                <p className="text-sm text-chrome-400 mt-1">Skipped</p>
                              )}
                            </div>
                            {!exercise.completed && !exercise.skipped && (
                              <button
                                onClick={() => startExercise(exercise)}
                                className="bg-chrome-600 hover:bg-chrome-500 px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors border border-chrome-500"
                              >
                                ‚ñ∂ Start
                              </button>
                            )}
                            {exercise.skipped && (
                              <button
                                onClick={() => {
                                  unskipExercise(exercise.name);
                                  startExercise(exercise);
                                }}
                                className="bg-chrome-700 hover:bg-chrome-600 px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors border border-chrome-600"
                              >
                                ‚Ü© Return
                              </button>
                            )}
                            {exercise.completed && (
                              <div className="text-chrome-300 font-bold text-2xl">‚úì</div>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>

                    <button
                      onClick={finishWorkout}
                      className="w-full mt-6 bg-chrome-600 hover:bg-chrome-500 py-5 rounded-lg font-bold text-xl transition-colors border-2 border-chrome-500"
                    >
                      Finish Workout
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen gorilla-overlay p-4 text-chrome-100">
              <div className="max-w-4xl mx-auto">
                <div className="text-center mb-8">
                  <h1 className="text-5xl font-bold mb-2 flex items-center justify-center gap-3">
                    ü¶ç GORILLA STRONG
                  </h1>
                  <p className="text-chrome-400">High-Intensity Training Tracker</p>
                </div>

                <div className="grid grid-cols-2 gap-4 mb-8">
                  <button
                    onClick={() => setShowProgress(true)}
                    className="bg-gradient-to-r from-chrome-700 to-chrome-600 hover:from-chrome-600 hover:to-chrome-500 p-6 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all shadow-lg border border-chrome-600 diamond-plate"
                  >
                    üìà View Progress
                  </button>
                  <button
                    onClick={() => setShowWorkoutBuilder(true)}
                    className="bg-gradient-to-r from-chrome-700 to-chrome-600 hover:from-chrome-600 hover:to-chrome-500 p-6 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all shadow-lg border border-chrome-600 diamond-plate"
                  >
                    ‚ûï Create Workout
                  </button>
                </div>

                <div className="bg-chrome-800 rounded-xl p-6 shadow-2xl border border-chrome-600 diamond-plate">
                  <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
                    üí™ Choose Your Workout
                  </h2>

                  {customWorkouts.length > 0 && (
                    <>
                      <h3 className="text-lg font-semibold mb-3 text-chrome-300">Your Custom Workouts</h3>
                      <div className="grid grid-cols-1 gap-3 mb-6">
                        {customWorkouts.map(workout => (
                          <div key={workout.id} className="bg-chrome-900 rounded-lg p-4 border border-chrome-700">
                            <div className="flex items-center justify-between mb-2">
                              <h4 className="font-semibold">{workout.name}</h4>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => editCustomWorkout(workout)}
                                  className="p-2 hover:bg-chrome-800 rounded-lg transition-colors"
                                >
                                  ‚úèÔ∏è
                                </button>
                                <button
                                  onClick={() => deleteCustomWorkout(workout.id)}
                                  className="p-2 hover:bg-red-900 rounded-lg transition-colors"
                                >
                                  üóëÔ∏è
                                </button>
                              </div>
                            </div>
                            <p className="text-sm text-chrome-400 mb-3">
                              {workout.exercises.length} exercises
                            </p>
                            <button
                              onClick={() => startWorkout(workout.name)}
                              className="w-full bg-chrome-600 hover:bg-chrome-500 py-2 rounded-lg font-semibold transition-colors border border-chrome-500"
                            >
                              Start Workout
                            </button>
                          </div>
                        ))}
                      </div>
                    </>
                  )}

                  <h3 className="text-lg font-semibold mb-3">Default Workouts</h3>
                  <div className="grid grid-cols-1 gap-3">
                    {Object.keys(defaultWorkouts).map(workoutType => (
                      <div key={workoutType} className="bg-chrome-900 rounded-lg p-4 hover:bg-chrome-800 transition-colors border border-chrome-700">
                        <h3 className="font-semibold mb-2">{workoutType}</h3>
                        <p className="text-sm text-chrome-400 mb-3">
                          {defaultWorkouts[workoutType].length} exercises
                        </p>
                        <button
                          onClick={() => startWorkout(workoutType)}
                          className="w-full bg-chrome-600 hover:bg-chrome-500 py-2 rounded-lg font-semibold transition-colors border border-chrome-500"
                        >
                          Start Workout
                        </button>
                      </div>
                    ))}
                  </div>
                </div>

                {workoutHistory.length > 0 && (
                  <div className="mt-8 bg-chrome-800 rounded-xl p-6 shadow-2xl border border-chrome-600 diamond-plate">
                    <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                      üèÜ Recent Workouts
                    </h3>
                    <div className="space-y-3">
                      {workoutHistory.slice(0, 5).map((workout, idx) => (
                        <div key={idx} className="bg-chrome-900 rounded-lg p-4 border border-chrome-700">
                          <div className="flex items-center justify-between mb-2">
                            <h4 className="font-semibold">{workout.workoutName}</h4>
                            <span className="text-sm text-chrome-400">
                              {new Date(workout.timestamp).toLocaleDateString()}
                            </span>
                          </div>
                          <p className="text-sm text-chrome-400">
                            {workout.exercises.length} exercises completed
                          </p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GorillaStrongApp />);
    </script>
</body>
</html>
